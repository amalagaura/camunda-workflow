<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.20
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<p><a href="https://travis-ci.com/amalagaura/camunda-workflow"><img src="https://travis-ci.com/amalagaura/camunda-workflow.svg?branch=master"></a> <a href="https://badge.fury.io/rb/camunda-workflow"><img src="https://badge.fury.io/rb/camunda-workflow.svg"></a> <a href="http://inch-ci.org/github/amalagaura/camunda-workflow"><img src="http://inch-ci.org/github/amalagaura/camunda-workflow.svg?branch=master"></a></p>

<h1 id="label-Camunda+Workflow">Camunda Workflow</h1>

<h2 id="label-An+opinionated+interface+to+Camunda+for+Ruby-2FRails+apps">An opinionated interface to Camunda for Ruby/Rails apps</h2>

<p><a href="https://github.com/remiprev/her">Her</a> is used to communicate with the <a href="https://docs.camunda.org/manual/latest/reference/rest/">Camunda REST API</a>.</p>

<h3 id="label-Add+to+your+Gemfile">Add to your Gemfile</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>camunda-workflow</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<h2 id="label-Camunda+Integration+with+Ruby">Camunda Integration with Ruby</h2>

<p>The process definitions key becomes the module name of your implementation classes and must be set to the name of a ruby style constant (screenshot example provided below). This same process definition key should be set as the topic name for external tasks. Tasks are pulled and fetched and locked and then run. We expect classes (ActiveJob) to implement each external task.</p>

<p><img src="https://www.evernote.com/l/Ajnoawx6CYhKha7OXUPkyeo6CjrxvSoTgOUB/image.png"></p>

<h3 id="label-Integration+with+your+worker+classes">Integration with your worker classes</h3>

<p>The module <code>ExternalTaskJob</code> should be included in your job implementation classes. The job implementation classes can inherit from <code>ActiveJob::Base</code>, or use <code>Sidekiq::Worker</code> or use some other system for job queuing.</p>

<p>Currently we call <code>perform_later</code> on job implementation classes. If we want to make this more flexible, we need to make the method used to queue jobs configurable. <code>perform_later</code> for ActiveJob, <code>perform_async</code> for Sidekiq, or <code>perform</code> if no background task system is used.</p>

<h3 id="label-Implementing+bpmn_perform">Implementing <code>bpmn_perform</code></h3>

<p><code>bpmn_perform</code> is your implementation of the service task.</p>

<h3 id="label-Supporting+bpmn+exceptions">Supporting bpmn exceptions</h3>

<p>Camunda supports throwing bpmn exceptions on a service task to communicate logic errors and not underlying code errors. These expected errors are thrown with <code>ruby raise Camunda::BpmnError.new error_code: &#39;bpmn-error&#39;, message: &quot;Special BPMN error&quot;, variables: { bpmn: &#39;error&#39; } </code></p>

<h2 id="label-Generators">Generators</h2>

<h3 id="label-BPMN+ActiveJob+install">BPMN ActiveJob install</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_generate'>generate</span> <span class='label'>camunda:</span><span class='id identifier rubyid_install'>install</span>
</code></pre>

<p>Creates <code>app/jobs/camunda_job.rb</code>. A class which inherits from ApplicationJob and includes <code>ExternalTaskJob</code>. It can be changed to include  Sidekiq::Worker instead.</p>

<p>All of the BPMN worker classes will inherit from this class</p>

<h3 id="label-Java+Spring+Boot+App+install">Java Spring Boot App install</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_generate'>generate</span> <span class='label'>camunda:</span><span class='id identifier rubyid_spring_boot'>spring_boot</span>
</code></pre>

<p>Creates a skeleton Java Spring Boot app, which also contains the minimal files to run unit tests on a BPMN file. This can be used to start a Camunda instance with a REST api. This can also be deployed to PCF by generating a Spring Boot jar and pushing it.</p>

<h3 id="label-BPMN+Classes">BPMN Classes</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_generate'>generate</span> <span class='label'>camunda:</span><span class='id identifier rubyid_bpmn_classes'>bpmn_classes</span>
</code></pre>

<p>Parses the BPMN file and creates task classes according to the ID of the process file and the ID of each task. It checks each task and only creates it if the topic name is the same as the process ID. This allows one to have some tasks be handled outside the Rails app. It confirms that the ID&#39;s are valid Ruby constant names.</p>

<h4 id="label-Starting+the+Camunda+server+for+development">Starting the Camunda server for development</h4>

<p>Start the application: <code>mvn spring-boot:run</code></p>

<p>Camunda-workflow defaults to an in-memory, h2 database engine. If you rather use a Postgres database engine, comment out the h2 database engine settings in the <code>pom.xml</code> file located in <code>bpmn/java_app</code>. Default settings for using Postgres are available in the <code>pom.xml</code> file. You will need to create a Postgres database on localhost called <code>camunda</code>.</p>

<h4 id="label-Engine+Route+Prefix+using+the+Java+Spring+Boot+app">Engine Route Prefix using the Java Spring Boot app</h4>

<p>The default engine route prefix for the provided Java Spring Boot app is <code>rest</code>. If you choose to download and use the Camunda distribution, the engine prefix is <code>rest-engine</code>. Camunda-workflow is configured to use <code>rest-engine</code>.</p>

<p>To override the default engine route prefix to allow your rails application to use the route prefix of <code>rest</code>, you need to add an initializer file in your rails app with the below code.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># filename initializers/camunda.rb
</span><span class='const'><span class='object_link'><a href="Camunda.html" title="Camunda (module)">Camunda</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Camunda/Workflow.html" title="Camunda::Workflow (module)">Workflow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="Camunda/Workflow.html#configure-class_method" title="Camunda::Workflow.configure (method)">configure</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_engine_route_prefix'>engine_route_prefix</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rest</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
</code></pre>

<h4 id="label-Enable+HTTP+Basic+Auth+for+Java+Spring+Boot+app">Enable HTTP Basic Auth for Java Spring Boot app</h4>

<p>To add authentication to Camunda&#39;s REST API within the Java Spring Boot app change the <code>camunda.authentication</code> variable located in the <code>application.properties</code> (bpmn/java_app/src/main/resources) file to <code>true</code>. Creating an environment variable <code>ENV['CAMUNDA_AUTH']</code> and setting a value of <code>true</code> or <code>false</code> will set the value as well. When HTTP Basic Auth is enabled, it&#39;s required that a user with the appropriate permissions is setup in Camunda. Otherwise, the request will return as <code>401 unauthorized</code>. Users are set up within the admin dashboard of Camunda and used to authenticate by passing an Authorization header during requests to the REST API. Below is how to configure the <code>camunda_user</code> and <code>camunda_password</code> to be used in the header request to authenticate using HTTP Basic Auth.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># filename initializers/camunda.rb
</span><span class='const'><span class='object_link'><a href="Camunda.html" title="Camunda (module)">Camunda</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Camunda/Workflow.html" title="Camunda::Workflow (module)">Workflow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="Camunda/Workflow.html#configure-class_method" title="Camunda::Workflow.configure (method)">configure</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_engine_route_prefix'>engine_route_prefix</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rest</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_camunda_user'>camunda_user</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CAMUNDA_USER</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_camunda_password'>camunda_password</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CAMUNDA_PASSWORD</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</code></pre>

<h4 id="label-Generating+a+jar+for+deployment">Generating a jar for deployment</h4>

<p><code>mvn package spring-boot:repackage</code></p>

<p>The jar is in <code>target/camunda-bpm-springboot.jar</code></p>

<h4 id="label-Deploying+to+PCF">Deploying to PCF</h4>

<p><code>cf push app_name -p target/camunda-bpm-springboot.jar</code></p>

<p>It will fail to start. Create a postgres database as a service in PCF and bind it to the application. The Springboot application is configured for Postgres and will then be able to start.</p>

<h4 id="label-Running+java+unit+tests">Running java unit tests</h4>

<p><code>mvn clean test</code></p>

<h2 id="label-Usage">Usage</h2>

<h3 id="label-Deploying+a+model">Deploying a model</h3>

<p>Uses a default name, etc. Below outlines how to deploy a process using the included sample.bpmn file created by the generator. Alternatively you can deploy using Camunda Modeler</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Camunda.html" title="Camunda (module)">Camunda</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Camunda/Deployment.html" title="Camunda::Deployment (class)">Deployment</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'><span class='object_link'><a href="Camunda/Deployment.html#create-class_method" title="Camunda::Deployment.create (method)">create</a></span></span> <span class='label'>file_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bpmn/diagrams/sample.bpmn</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<h3 id="label-Processes">Processes</h3>

<h4 id="label-Starting+a+process">Starting a process</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_start_response'>start_response</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Camunda.html" title="Camunda (module)">Camunda</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Camunda/ProcessDefinition.html" title="Camunda::ProcessDefinition (class)">ProcessDefinition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_start_by_key'><span class='object_link'><a href="Camunda/ProcessDefinition.html#start_by_key-class_method" title="Camunda::ProcessDefinition.start_by_key (method)">start_by_key</a></span></span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CamundaWorkflow</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>variables:</span> <span class='lbrace'>{</span> <span class='label'>x:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>abcd</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>businessKey:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WorkflowBusinessKey</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p><strong>Camunda cannot handle snake case variables, all snake_case variables are serialized to camelCase before a request is sent to the REST api. Variables returned back from the Camunda API will be deserialized back to snake_case.</strong></p>

<p><code>{ my_variable: &quot;xyz&quot; }</code></p>

<p>will be converted to:</p>

<p><code>{ myVariable: &quot;xyz&quot; }</code></p>

<h4 id="label-Destroy+a+process">Destroy a process</h4>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Camunda.html" title="Camunda (module)">Camunda</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Camunda/ProcessInstance.html" title="Camunda::ProcessInstance (class)">ProcessInstance</a></span></span><span class='period'>.</span><span class='id identifier rubyid_destroy_existing'>destroy_existing</span> <span class='id identifier rubyid_start_response'>start_response</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
</code></pre>

<h3 id="label-Tasks">Tasks</h3>

<h4 id="label-Fetch+tasks+and+queue+with+ActiveJob">Fetch tasks and queue with ActiveJob</h4>

<p>The poller will run as an infinite loop with long polling to fetch tasks, queue, and run them. Topic is the process definition key, as show in the screenshot example from the Camunda Modeler.</p>

<p>Below will run the poller to fetch, lock, and run a task for the example process definition located in the <code>starting a process</code> detailed above.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Camunda.html" title="Camunda (module)">Camunda</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Camunda/Poller.html" title="Camunda::Poller (class)">Poller</a></span></span><span class='period'>.</span><span class='id identifier rubyid_fetch_and_execute'><span class='object_link'><a href="Camunda/Poller.html#fetch_and_execute-class_method" title="Camunda::Poller.fetch_and_execute (method)">fetch_and_execute</a></span></span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>CamundaWorkflow</span><span class='tstring_end'>]</span></span>
</code></pre>

<h4 id="label-Fetch+tasks">Fetch tasks</h4>

<p>For testing from the console</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_tasks'>tasks</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Camunda.html" title="Camunda (module)">Camunda</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Camunda/ExternalTask.html" title="Camunda::ExternalTask (class)">ExternalTask</a></span></span><span class='period'>.</span><span class='id identifier rubyid_fetch_and_lock'><span class='object_link'><a href="Camunda/ExternalTask.html#fetch_and_lock-class_method" title="Camunda::ExternalTask.fetch_and_lock (method)">fetch_and_lock</a></span></span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>CamundaWorkflow</span><span class='tstring_end'>]</span></span>
</code></pre>

<h4 id="label-Run+a+task">Run a task</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:run_now</span><span class='rparen'>)</span>
</code></pre>

<h3 id="label-User+Tasks">User Tasks</h3>

<h4 id="label-Mark+a+user+task+complete">Mark a user task complete</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_task'>task</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Camunda.html" title="Camunda (module)">Camunda</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Camunda/Task.html" title="Camunda::Task (class)">Task</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_business_key_and_task_definition_key!'><span class='object_link'><a href="Camunda/Task.html#find_by_business_key_and_task_definition_key!-class_method" title="Camunda::Task.find_by_business_key_and_task_definition_key! (method)">find_by_business_key_and_task_definition_key!</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_instance_business_key'>instance_business_key</span><span class='comma'>,</span> <span class='id identifier rubyid_task_key'>task_key</span><span class='rparen'>)</span>
  <span class='comment'># Or you can query Camunda::Task with other parameters like assignee 
</span>  <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_complete!'>complete!</span><span class='lparen'>(</span><span class='label'>var1:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre>

<h3 id="label-Rspec+Helpers">Rspec Helpers</h3>

<p>RSpec helpers can will validate your application to make sure it has a class for every External task in a given BPMN file. “`ruby require &#39;camunda/matchers&#39;</p>

<p>RSpec.describe “BPMN Diagrams” do  describe Camunda::BpmnXML.new(File.open(“bpmn/diagrams/YourFile.bpmn”)) do  it { is_expected.to have_module(&#39;YourModule&#39;) }  it { is_expected.to <a href="YourModule">have_topics(%w</a>) }  it { is_expected.to have_defined_classes }  end end “`</p>

<h4 id="label-Note-3A">Note:</h4>

<p>If you get an error</p>

<pre class="code ruby"><code class="ruby">    ** ERROR: directory is already being watched! **

    Directory: bpmn/java_app/src/main/resources
    is already being watched through: bpmn/diagrams

    MORE INFO: https://github.com/guard/listen/wiki/Duplicate-directory-errors
</code></pre>

<p>It is because ActionMailer preview causes test/mailers/previews to get added to the Rails EventedFileChecker by default. RSpec is supposed to override it, but it is not appropriately overridden for EventedFileChecker and/or you don&#39;t have spec/mailers/preview existing. If that directory does not exist, it goes to the first common directory that exists, which is your Rails root folder. So EventedFileChecker is listening to your entire Rails folder. Not a big problem, but it causes a problem for our created symlink.</p>

<p>So add:</p>

<pre class="code ruby"><code class="ruby">    <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_action_mailer'>action_mailer</span><span class='period'>.</span><span class='id identifier rubyid_show_previews'>show_previews</span> <span class='op'>=</span> <span class='kw'>false</span>
</code></pre>

<p>to your <code>development.rb</code> file to solve listen errors about a symlink. Unless you are using ActionMailer previews, in which case you should have the directory created already.</p>

<h2 id="label-Contributing">Contributing</h2>

<p>See <a href="CONTRIBUTING.md">CONTRIBUTING</a> for additional information.</p>

<h2 id="label-Public+domain">Public domain</h2>

<p>This project is in the worldwide <a href="LICENSE.md">public domain</a>. As stated in <a href="CONTRIBUTING.md">CONTRIBUTING</a>:</p>

<blockquote>
<p>This project is in the public domain within the United States, and copyright and related rights in the work worldwide are waived through the <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0 1.0 Universal public domain dedication</a>.</p>

<p>All contributions to this project will be released under the CC0 dedication. By submitting a pull request, you are agreeing to comply with this waiver of copyright interest.</p>
</blockquote>
</div></div>

      <div id="footer">
  Generated on Tue Dec  3 16:12:07 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.20 (ruby-2.6.3).
</div>

    </div>
  </body>
</html>